/*! Compiled on: 2014-11-25 */
var fileVersion = 20141125; 
"use strict";define(["modules/app","currentUser","storage"],function(app){app.factoryManager("goalsFactory",["$q","$storage","$resource","$rootScope","$cookies","$http","config","usersFactory","$beacon",function($q,$storage,$resource,$rootScope,$cookies,$http,config,usersFactory,$beacon){{var path=config.api+"/goals",self=this;new $storage({dbVersion:1,storeName:"goals",keyPath:"id",indexes:[{name:"id",keyPath:"id"}]})}$beacon.on("authentication.change",function(loggedin){loggedin||(self.$currentUser=null)});var format=function(goal){if(self.$currentUser)for(var i=0;i<self.$currentUser.goals.length;i++)self.$currentUser.goals[i].id==goal.id&&(goal.checked=!0);return goal};self.getAll=function(){var deferred=$q.defer();return resource.get({},function(result){for(var goals=[],i=0;i<result.data.length;i++)goals.push(format(result.data[i]));deferred.resolve(format(goals))}),deferred.promise};var resource=$resource(path+"",{},{get:{method:"GET",authentication:!0},update:{method:"PUT",authentication:!0}});return self}])});