/*! Compiled on: Thu May 21 2015 08:13:23 */
var fileVersion = "v1.0-4-f842d9e-dirty"; 
"use strict";define(["modules/app","dishesFactory","mixpanelFactory"],function(app){app.controllerManager("surveyCtrl",["config","$scope","$rootScope","$state","dishesFactory","$loading","mixpanelFactory","$error","$http","$cookies","$stateParams",function(config,$scope,$rootScope,$state,dishesFactory,$loading,mixpanelFactory,$error,$http,$cookies,$stateParams){$loading.start(!0);var survey_id=$stateParams.survey_type||null;$scope.samples=[];for(var i=30;i--;)$scope.samples.push({id:null});mixpanelFactory.track("Survey viewed"),$scope.activeIndex=0,$scope.dislike=function(dish){dish.liked=!1,dish.disliked=!0},$scope.like=function(dish){dish.liked=!0,dish.disliked=!1},$scope.next=function(){if($scope.activeIndex+1==$scope.samples.length){$loading.start();var data=[];angular.forEach($scope.samples,function(dish){data.push({id:dish.id,rate:dish.liked?1:dish.disliked?-1:0})}),$http.put(config.api+"/survey",{data:data},{headers:{Authorization:$cookies.get("access_token")}}).then(function(){$loading.end(),$state.transitionTo("primary.dishes").then(function(){$error.success(null,"Thank you for participating in the survey.")})})}else $scope.activeIndex++},dishesFactory.getDishesForSurvey({survey_id:survey_id||-1}).then(function(dishes){$loading.end(),$scope.samples=dishes})}]),app.factoryManager("$slider",[function(){}]),app.directiveManager("slider",[function(){return{restrict:"A",link:function($scope,$element){$scope.margin=0;var setWidth=function(){$scope.panelWidth=465,window.innerWidth<640&&($scope.panelWidth=300);var w=$($element[0]).width()+2*$scope.margin;$scope.initialLeft=(w-$scope.panelWidth)/2,$scope.$$phase||$scope.$apply()};"onorientationchange"in window?window.onorientationchange=setWidth:window.onresize=setWidth,setWidth()}}}])});