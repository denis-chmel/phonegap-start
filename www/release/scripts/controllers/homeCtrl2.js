/*! Compiled on: Mon Jul 07 2014 17:12:43 */
var fileVersion = "v0.4.1-0-111247d-dirty"; 
"use strict";define(["modules/app","goalsFactory","dietsFactory","welcomeTour","mixpanelFactory"],function(app){app.controllerManager("homeCtrl2",["$scope","$rootScope","$state","$currentUser","$modal","mixpanelFactory","$facebook","$loading","authenticationFactory","$error","$timeout","goalsFactory","dietsFactory",function($scope,$rootScope,$state,$currentUser,$modal,mixpanelFactory,$facebook,$loading,authenticationFactory,$error,$timeout,goalsFactory,dietsFactory){$scope.step=1,$currentUser.id&&($scope.step=3,0==$currentUser.goals.length?$scope.step=2:$currentUser.diets.length&&$state.transitionTo("primary.tastes")),$scope.goals=[],$scope.diets=[],goalsFactory.getAll().then(function(goals){$scope.goals=goals}),dietsFactory.getAll().then(function(diets){$scope.diets=diets}),mixpanelFactory.track("HomePage Visit"),$rootScope.facebookAuthenticate=function(){return window.FB.login?($loading.start(),void $facebook.login({scope:"email,user_birthday"}).then(function(response){authenticationFactory.facebook(response.authResponse.accessToken).then(function(){authenticationFactory.me().then(function(){$loading.end()},function(){$loading.end()})},function(){$loading.end()})})):void $error.alert("authentication","Facebook is blocked in this browser. Please use your email address to sign up.")},$rootScope.signinmodal=function(){$modal.open({windowClass:"fullscreen signin",templateUrl:"/release/html/modals/account/signin.html"})},$rootScope.signupmodal=function(){$modal.open({windowClass:"fullscreen signup",templateUrl:"/release/html/modals/account/signup.html"})},$timeout(function(){$scope.loginMessage&&($("#signin-form:visible").length?$rootScope.loginNowTour=!0:$scope.signinmodal())})}])});